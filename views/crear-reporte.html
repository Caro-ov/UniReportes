<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Head común -->
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>UniReportes - Crear Reporte</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico"/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <!-- CSS - Cargado estáticamente para evitar retrasos -->
    <link rel="stylesheet" href="css/components.css"/>
    <link rel="stylesheet" href="css/crear-reporte.css"/>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Script de seguridad -->
    <script>
    if (window.location.pathname !== '/login.html' && 
        window.location.pathname !== '/' && 
        !window.location.pathname.includes('index.html')) {
        if (sessionStorage.getItem('logout_flag')) {
            sessionStorage.removeItem('logout_flag');
            window.location.replace('/login.html');
        }
        window.addEventListener('pageshow', function(event) {
            if (event.persisted || sessionStorage.getItem('logout_flag')) {
                sessionStorage.removeItem('logout_flag');
                window.location.replace('/login.html');
            }
        });
    }
    </script>
</head>
<body data-page="new-report" data-title="UniReportes - Crear Reporte" data-css="crear-reporte">
    <div class="contenedor-principal">
        <!-- Overlay para móvil -->
        <div class="overlay" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar de navegación -->
        <aside id="sidebar-container" class="sidebar">
            <!-- Sidebar será cargado aquí -->
        </aside>

        <!-- Contenido principal -->
        <div class="contenido-wrapper">
            <!-- Header superior -->
            <header id="header-container" class="header-principal">
                <!-- Header será cargado aquí -->
            </header>

            <!-- Contenido principal -->
            <main class="contenido-principal">
                <div class="contenedor-formulario">
                    <div class="encabezado-pagina">
                        <h2 class="titulo-pagina">Crear un nuevo reporte</h2>
                        <p class="descripcion-pagina">
                            Ayúdanos a mejorar la universidad. Selecciona el problema que encontraste para que podamos solucionarlo lo antes posible.
                        </p>
                    </div>

                    <div class="tarjeta-formulario">
                        <form class="formulario-reporte" id="formulario-reporte">
                            <!-- Categoría -->
                            <div class="campo-formulario">
                                <label for="categoria" class="etiqueta-campo">Categoría <span class="requerido">*</span></label>
                                <select id="categoria" name="categoria" class="select-personalizado" required>
                                    <option disabled selected value="">Selecciona una categoría...</option>
                                </select>
                                <span class="texto-ayuda">Selecciona primero una categoría para ver los objetos disponibles</span>
                            </div>

                            <!-- Objeto -->
                            <div class="campo-formulario">
                                <label for="objeto" class="etiqueta-campo">Objeto</label>
                                <select id="objeto" name="objeto" class="select-personalizado" disabled>
                                    <option disabled selected value="">Primero selecciona una categoría...</option>
                                </select>
                                <span class="texto-ayuda">Selecciona primero una categoría para ver los objetos disponibles</span>
                            </div>

                            <!-- Título del reporte -->
                            <div class="campo-formulario">
                                <label for="titulo" class="etiqueta-campo">Título del reporte <span class="requerido">*</span></label>
                                <div class="campo-con-icono">
                                    <span class="material-symbols-outlined icono-campo">description</span>
                                    <input type="text" id="titulo" name="titulo" 
                                           placeholder="Ej: Aire acondicionado dañado en Aula 203" 
                                           class="input-con-icono" required/>
                                </div>
                            </div>

                            <!-- Ubicación -->
                            <div class="campo-formulario">
                                <label for="ubicacion" class="etiqueta-campo">Ubicación <span class="requerido">*</span></label>
                                <div class="campo-con-icono">
                                    <span class="material-symbols-outlined icono-campo">business</span>
                                    <select id="ubicacion" name="ubicacion" class="input-con-icono select-personalizado" required>
                                        <option disabled selected value="">Selecciona una ubicación...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Salón -->
                            <div class="campo-formulario">
                                <label for="salon" class="etiqueta-campo">Salón <span class="requerido">*</span></label>
                                <div class="campo-con-icono">
                                    <span class="material-symbols-outlined icono-campo">room</span>
                                    <select id="salon" name="salon" class="input-con-icono select-personalizado" disabled required>
                                        <option disabled selected value="">Primero selecciona una ubicación...</option>
                                    </select>
                                </div>
                                <span class="texto-ayuda">Selecciona primero una ubicación para ver los salones disponibles</span>
                            </div>

                            <!-- Fecha del reporte -->
                            <div class="campo-formulario">
                                <label for="fecha-reporte" class="etiqueta-campo">Fecha del reporte <span class="requerido">*</span></label>
                                <div class="campo-con-icono">
                                    <span class="material-symbols-outlined icono-campo">calendar_today</span>
                                    <input type="date" id="fecha-reporte" name="fecha-reporte" 
                                           class="input-con-icono" required max="9999-12-31"/>
                                </div>
                                <span class="texto-ayuda">¿Cuándo ocurrió el problema?</span>
                            </div>

                            <!-- Hora del reporte -->
                            <div class="campo-formulario">
                                <label for="hora-reporte" class="etiqueta-campo">Hora del reporte <span class="requerido">*</span></label>
                                <div class="campo-con-icono">
                                    <span class="material-symbols-outlined icono-campo">schedule</span>
                                    <input type="time" id="hora-reporte" name="hora-reporte" 
                                           class="input-con-icono" required/>
                                </div>
                                <span class="texto-ayuda">¿A qué hora aproximadamente?</span>
                            </div>

                            <!-- Descripción -->
                            <div class="campo-formulario">
                                <label for="descripcion" class="etiqueta-campo">Descripción <span class="requerido">*</span></label>
                                <textarea id="descripcion" name="descripcion" rows="4" 
                                          placeholder="Añade detalles del problema. ¿Qué pasó? ¿Cuándo lo notaste?"
                                          class="textarea-personalizado" required></textarea>
                            </div>

                            <!-- Subir archivos -->
                            <div class="campo-formulario">
                                <label for="photo" class="etiqueta-campo">Añadir fotos y videos (opcional)</label>
                                <div class="zona-subida-archivo">
                                    <div class="contenido-subida">
                                        <svg class="icono-subida" fill="none" stroke="currentColor" viewBox="0 0 48 48">
                                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                                        </svg>
                                        <div class="texto-subida">
                                            <label for="file-upload" class="enlace-subida">
                                                <span>Sube archivos</span>
                                                <input id="file-upload" name="file-upload" type="file" multiple accept="image/*,video/*" class="input-oculto"/>
                                            </label>
                                            <span class="texto-adicional">o arrastra y suelta múltiples archivos</span>
                                        </div>
                                        <p class="texto-ayuda">PNG, JPG, GIF, MP4, MOV, AVI hasta 50MB cada uno</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Botón de envío -->
                            <div class="contenedor-boton-envio">
                                <button type="submit" class="boton-envio">
                                    <span class="material-symbols-outlined">send</span>
                                    Enviar Reporte
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="footer-principal">
                <div class="footer-contenido">
                    <p class="texto-footer">© 2024 UniReportes. Todos los derechos reservados.</p>
                </div>
            </footer>
        </div>
        
        <!-- Indicador de carga SPA -->
        <div class="spa-loader"></div>
    </div>

    <script>
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('open');
        }

        // Cerrar sidebar al hacer clic fuera de ella en móvil
        document.addEventListener('click', function(event) {
            const sidebar = document.querySelector('.sidebar');
            const menuButton = document.querySelector('.boton-menu-movil');
            
            if (window.innerWidth <= 1024 && 
                !sidebar.contains(event.target) && 
                !menuButton.contains(event.target) && 
                sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        });
    </script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Sistema de componentes -->
    <script src="js/components.js"></script>
    <!-- Sistema de navegación SPA -->
    <script src="js/spa-navigation.js"></script>
    <!-- JavaScript personalizado -->
    <script src="js/crear-reporte.js"></script>
</body>
</html>