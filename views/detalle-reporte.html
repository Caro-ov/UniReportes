<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Head común para todas las páginas -->
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>UniReportes</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico"/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <!-- Precarga de CSS comunes para reducir retrasos -->
    <link rel="preload" href="css/dashboard.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <link rel="preload" href="css/admin-dashboard.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <link rel="preload" href="css/crear-reporte.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <link rel="preload" href="css/perfil.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <link rel="preload" href="css/mis-reportes.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <link rel="preload" href="css/detalle-reporte.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <!-- CSS Base - Cargado estáticamente para evitar retrasos -->
    <link rel="stylesheet" href="css/components.css"/>
    <link rel="stylesheet" href="css/responsive.css"/>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Script de seguridad para prevenir navegación hacia atrás después del logout -->
    <script>
    // Prevenir navegación hacia atrás en páginas protegidas
    if (window.location.pathname !== '/login.html' && 
        window.location.pathname !== '/' && 
        !window.location.pathname.includes('index.html')) {
        
        // Verificar si hay marcador de logout en sessionStorage
        if (sessionStorage.getItem('logout_flag')) {
            sessionStorage.removeItem('logout_flag');
            window.location.replace('/login.html');
        }
        
        // Listener para prevenir navegación hacia atrás
        window.addEventListener('pageshow', function(event) {
            if (event.persisted || sessionStorage.getItem('logout_flag')) {
                sessionStorage.removeItem('logout_flag');
                window.location.replace('/login.html');
            }
        });
    }
    </script>
</head>
<body data-page="mis-reportes" data-title="UniReportes - Detalles del Reporte" data-css="detalle-reporte">
    <div class="contenedor-principal">
        <!-- Overlay para móvil -->
        <div class="overlay" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar de navegación -->
        <aside id="sidebar-container" class="sidebar">
            <!-- Sidebar será cargado aquí -->
        </aside>

        <!-- Contenido wrapper -->
        <div class="contenido-wrapper">
            <!-- Header superior -->
            <header id="header-container" class="header-principal">
                <!-- Header será cargado aquí -->
            </header>

        <!-- Contenido principal -->
        <main class="contenido-principal">
            <div class="contenedor-contenido">
                <!-- Breadcrumb -->
                <div class="breadcrumb-container">
                    <nav class="breadcrumb">
                        <a href="#" class="breadcrumb-link" data-spa-nav="mis-reportes">Reportes</a>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-current">Cargando...</span>
                    </nav>
                </div>

                <!-- Tarjeta principal del reporte -->
                <div class="tarjeta-reporte">
                    <!-- Header del reporte -->
                    <div class="reporte-header">
                        <div class="header-info">
                            <h2 class="titulo-reporte">Cargando...</h2>
                            <div class="estado-container">
                                <span class="estado estado-enviado">Cargando...</span>
                            </div>
                        </div>
                        <div class="header-actions">
                            <p class="numero-reporte">Reporte #---</p>
                            <div class="botones-header">
                                <button id="btn-editar-reporte" class="btn-editar" onclick="toggleEditarReporte()">
                                    <span class="material-symbols-outlined">edit</span>
                                    Editar Reporte
                                </button>
                                <button id="btn-guardar-cambios" class="btn-guardar-cambios" onclick="guardarCambiosReporte()" style="display: none;">
                                    <span class="material-symbols-outlined">save</span>
                                    Guardar Cambios
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Contenido del reporte -->
                    <div class="reporte-contenido">
                        <!-- Detalles del reporte -->
                        <div class="detalles-section">
                            <h3 class="section-titulo">Detalles del reporte</h3>
                            <div class="detalles-grid">
                                <!-- Los detalles se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>

                    <!-- Archivos adjuntos - Sección independiente -->
                    <div class="archivos-section">
                        <div class="section-header">
                            <h3 class="section-titulo">Archivos adjuntos</h3>
                            <div class="archivos-acciones" style="display: none;">
                                <input type="file" id="nuevos-archivos" accept="image/*,video/*" multiple style="display: none;">
                                <button id="btn-agregar-archivo" class="btn-agregar-archivo" onclick="document.getElementById('nuevos-archivos').click()">
                                    <span class="material-symbols-outlined">add</span>
                                    Agregar archivo
                                </button>
                            </div>
                        </div>
                        <div class="archivos-grid">
                            <!-- Los archivos se cargarán dinámicamente -->
                        </div>
                    </div>

                    <!-- Historial de cambios -->
                    <div class="historial-section">
                        <h3 class="section-titulo">Historial de cambios</h3>
                        <div class="timeline">
                            <!-- El historial se cargará dinámicamente -->
                        </div>
                    </div>

                    <!-- Comentarios -->
                    <div class="comentarios-section">
                        <h3 class="section-titulo">Comentarios</h3>
                        <div class="comentarios-lista">
                            <!-- Los comentarios se cargarán dinámicamente -->
                        </div>
                        
                        <!-- Formulario para añadir comentario -->
                        <div class="agregar-comentario">
                            <div class="comentario-form">
                                <div class="form-header">
                                    <div class="usuario-avatar">
                                        <span class="material-symbols-outlined">person</span>
                                    </div>
                                    <div class="usuario-info">
                                        <span class="usuario-nombre">Cargando...</span>
                                        <span class="usuario-rol">Cargando...</span>
                                    </div>
                                </div>
                                <div class="form-contenido">
                                    <textarea 
                                        id="nuevo-comentario" 
                                        placeholder="Escribe un comentario sobre el reporte..."
                                        rows="3"
                                    ></textarea>
                                    <div class="form-acciones">
                                        <button type="button" class="btn-cancelar" onclick="limpiarComentario()">
                                            Cancelar
                                        </button>
                                        <button type="button" class="btn-enviar" onclick="enviarComentario()">
                                            <span class="material-symbols-outlined">send</span>
                                            Enviar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Añadir comentario -->
                    <div class="agregar-comentario-section" style="display: none;">
                        <h3 class="section-titulo">Añadir comentario</h3>
                        <div class="comentario-form">
                            <div class="form-avatar"></div>
                            <div class="form-contenido">
                                <textarea class="comentario-textarea" placeholder="Escribe tu comentario aquí..." rows="4"></textarea>
                                <div class="form-acciones">
                                    <button class="boton-adjuntar">
                                        <span class="material-symbols-outlined">attach_file</span>
                                        Adjuntar foto
                                    </button>
                                    <button class="boton-enviar">Enviar comentario</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        </div>
    </div>

    <script>
        // La funcionalidad del sidebar móvil se maneja en components.js
        // No duplicar código aquí
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Sistema de componentes -->
    <script src="js/components.js"></script>
    <script src="js/detalle-reporte-common.js"></script>
    <script src="js/detalle-reporte.js"></script>
</body>
</html>